// Bu, Prisma şemanızın başlangıcıdır.
// Veritabanı bağlantınızı ve ayarlarınızı buradan yapılandırırsınız.

generator client {
  provider = "prisma-client-js"
}

// Veritabanı Sağlayıcınızı buradan seçin (örn: postgresql, mysql, sqlite, vb.)
datasource db {
  provider = "postgresql" // Örnek olarak PostgreSQL kullanılmıştır
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

// --- KAYIT SİSTEMİ: ADMIN, COMPANY ve SITE ---

// Admin Modeli
// Bireysel veya Şirket hesabı olabilir.
model Admin {
  id           Int         @id @default(autoincrement())
  full_name    String
  email        String      @unique
  password     String // Şifrenin hash'lenerek saklanması önerilir.
  account_type AccountType // 'INDIVIDUAL' veya 'COMPANY'
  company_name String? // account_type 'COMPANY' ise doldurulur.
  created_at   DateTime    @default(now())
  updated_at   DateTime    @updatedAt

  // İlişkiler
  sites_created Site[] // Admin'in oluşturduğu siteler

  @@map("admins")
  @@schema("public")
}

// Hesap Türü Enum'u
enum AccountType {
  INDIVIDUAL
  COMPANY

  @@schema("public")
}

// Site Modeli
// Admin tarafından oluşturulur ve Admin veya Company ile ilişkilendirilir.
model Site {
  id           Int      @id @default(autoincrement())
  site_id      String   @unique // Site için benzersiz kimlik (örn: slug veya UUID)
  site_name    String
  site_address String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Admin İlişkisi
  adminId Int // Siteyi oluşturan Admin'in ID'si
  admin   Admin @relation(fields: [adminId], references: [id])

  // Company Adı İlişkisi: Eğer Admin bir şirket adına site oluşturduysa, bu alan doldurulabilir.
  // Not: Şirket modelini ayrı tutmak daha iyi bir tasarım olabilir, ancak talepte company_name Admin'de tutulduğu için bu şekilde bırakılmıştır.
  // Ancak siteyi şirket adına bağlama mantığını takip etmek için, aslında adminin şirket türünde olması yeterlidir.
  // Şirket Adı burada sadece bilgi amaçlı tutulabilir veya Admin'den çekilebilir.

  // Kullanıcı İlişkisi
  users User[] // Bu siteye bağlı kullanıcılar

  @@map("sites")
  @@schema("public")
}

// --- KULLANICI SİSTEMİ: USER ---

// Kullanıcı Modeli
// Siteye bağlı kullanıcılar.
model User {
  id           Int      @id @default(autoincrement())
  full_name    String
  email        String   @unique
  phone_number String?  @unique
  password     String // Şifrenin hash'lenerek saklanması önerilir.
  block_no     String? // Kullanıcının yapıdaki blok numarası
  apartment_no String? // Kullanıcının daire numarası
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Site İlişkisi (siteId, kullanıcının hangi siteye ait olduğunu belirtir.)
  siteId Int
  site   Site @relation(fields: [siteId], references: [id])

  @@map("users")
  @@schema("public")
}
